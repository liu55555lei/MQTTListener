# MQTT监听工具 - 标识位功能使用说明

## 功能概述

本次更新为MQTT监听工具增加了标识位提取功能，可以自动从JSON消息中提取指定的标识信息，方便快速查询和过滤消息。

## 主要功能

### 1. 标识位路径配置
- 在配置页面可以为每个监听通道设置标识位路径
- 支持简单路径（如：`id`）和嵌套路径（如：`data.id`、`user.profile.name`）
- 标识位路径用于从JSON消息中提取对应的值

### 2. 自动标识位提取
- 系统会自动从接收到的JSON消息中提取标识位值
- 提取的值会保存在数据库的`identifier_value`字段中
- 支持字符串、数字等各种类型的标识位值

### 3. 优化查询界面
- 通道选择改为下拉框，显示已配置的监听通道
- 标识值支持多行输入，每行一个值，查询时匹配任意一个即可
- 列表显示优化：只显示通道名、标识信息、接收时间
- 提供"查看JSON"按钮，按需查看完整的JSON内容

## 使用步骤

### 1. 配置标识位路径
1. 访问配置页面（`/config.html`）
2. 在"监听通道管理"部分，输入Topic名称
3. 在"标识位路径"字段输入JSON路径（如：`id`、`data.id`等）
4. 点击"添加"按钮

### 2. 查询消息
1. 访问查询页面（`/query.html`）
2. 选择要查询的通道（下拉框显示已配置的通道）
3. 设置时间范围（可选）
4. 在标识值文本框中输入要查询的标识值：
   - 支持单行输入：`12345`
   - 支持多行输入：
     ```
     12345
     67890
     abc123
     ```
5. 点击"查询"按钮

### 3. 查看结果
- 列表显示：通道名、标识信息、接收时间
- 点击"查看JSON"按钮可以查看完整的JSON内容

## 数据库变更

### 新增字段
- `mqtt_topic.identifier_path`：标识位路径
- `mqtt_message.identifier_value`：标识位值

### 索引优化
- 为`identifier_value`字段添加了索引，提高查询性能

## 示例

### JSON消息示例
```json
{
  "id": "device001",
  "timestamp": "2024-01-01T10:00:00Z",
  "data": {
    "temperature": 25.5,
    "humidity": 60,
    "device_id": "sensor_001"
  }
}
```

### 配置示例
- Topic名称：`sensors/temperature`
- 标识位路径：`id`（提取设备ID）
- 或者：`data.device_id`（提取传感器ID）

### 查询示例
- 查询设备ID为"device001"的所有消息
- 查询多个设备ID：
  ```
  device001
  device002
  device003
  ```

## 注意事项

1. 标识位路径必须与JSON结构匹配
2. 如果JSON消息格式不正确，标识位提取会失败，但消息仍会保存
3. 查询时支持多个标识值，系统会匹配任意一个
4. 建议为常用的标识位路径创建索引以提高查询性能
